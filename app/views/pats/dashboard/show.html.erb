<div class="container-fluid px-0" style="max-width: 480px; margin: 0 auto; min-height: 100vh; background-color: #ffffff;">
  <!-- Main Content -->
  <div class="px-3 pb-5 mb-5">
    <!-- Header -->
    <header class="d-flex justify-content-between align-items-start pt-3 pb-3">
      <div>
        <h1 class="fs-4 fw-bold mb-1">ğŸ‘‹ Hola, <%= current_patient.first_name %></h1>
        <p class="text-muted small mb-0">Tu plan, paso a paso. Hoy lo haces simple ğŸŒ¿</p>
      </div>
      <button class="btn btn-link text-secondary p-2">
        <i class="bi bi-bell fs-5"></i>
      </button>
    </header>

    <!-- Objetivo CalÃ³rico Card -->
    <section class="card border-0 shadow-sm rounded-4 mb-3" style="background-color: #f8f9fa;">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <p class="text-muted small fw-medium mb-1">Objetivo calÃ³rico diario</p>
            <h2 class="fs-1 fw-bold mb-0"> <%= current_patient.plans.last&.meals&.sum(:calories) || 0 %> <span class="fs-6 fw-normal">kcal</span></h2>
            <p class="text-muted" style="font-size: 0.75rem; margin-top: 0.25rem;">P: 135g G: 60g C: 180g</p>
            <p class="text-muted" style="font-size: 0.7rem; margin-top: 0.5rem;">Plan: 1 Oct â€“ 31 Oct</p>
          </div>
          <div class="position-relative" style="width: 90px; height: 90px;">
            <svg width="90" height="90" style="transform: rotate(-90deg);">
              <circle cx="45" cy="45" r="38" fill="none" stroke="#e9ecef" stroke-width="8"/>
              <circle cx="45" cy="45" r="38" fill="none" stroke="#86efac" stroke-width="8"
                      stroke-dasharray="238.76" stroke-dashoffset="59.69" stroke-linecap="round"/>
            </svg>
            <div class="position-absolute top-50 start-50 translate-middle text-center">
              <span class="fs-4 fw-bold">75%</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Peso Actual Card -->
    <section class="card border shadow-sm rounded-4 mb-3">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h3 class="fs-6 fw-semibold mb-1">Peso actual</h3>
            <p class="text-muted mb-0" style="font-size: 0.75rem;">Ãšltimo registro: hace 2 dÃ­as</p>
          </div>
          <div class="d-flex align-items-baseline">
            <span class="fs-1 fw-bold"><%= current_patient&.weight_patients&.last&.weight || 0 %></span>
            <span class="fs-6 text-muted ms-1">kg</span>
          </div>
        </div>
        <%= link_to new_weight_patient_path, class: "btn btn-dark w-100 py-2 fw-semibold rounded-3 shadow-sm d-flex align-items-center justify-content-center gap-2 text-decoration-none" do %>
          <i class="bi bi-speedometer2"></i>
          Registrar Peso
        <% end %>
      </div>
    </section>

    <!-- Almuerzo Card -->
    <section class="card border shadow-sm rounded-4 mb-3 overflow-hidden">
      <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuCOrvOVp-O1cHUuYnmNtXqoSePRve3n54_StBo9UZM0ZLNIqNwqpLZozupusf5H0ZabQ0rdHIj94lFSh7lGu3oiJseFt7r87VJ2QF6LQ9KPG7Kcnvt-hlsrZphh6p0Uh6R6glNdkn6AmbgHAg5_lYPSgr1b1n08LSaZJ_RymRUvkq-I_1TKCP8t0B9fMmVkDaFLjs03LQ9Ah2P3MEoFh6Tecj4my9oIk6LDwvO9vdM4xdfxrTrgj-wPKeGm9dEfXRy9pidIclgAocc"
           class="card-img-top" alt="Ensalada de pollo y quinoa" style="height: 130px; object-fit: cover;">
      <div class="card-body p-3">
        <h3 class="fw-bold fs-6 mb-1"><%= current_patient&.meals&.first&.meal_type || "Sin plan asignado" %></h3>
        <p class="text-muted small mb-2"><%= current_patient&.meals&.first&.ingredients&.truncate(15) || "Sin plan asignado"  %></p>
        <p class="text-muted mb-3" style="font-size: 0.75rem;"></p>
        <% if current_patient&.meals&.first.present? %>
          <%= link_to meal_path(current_patient.meals.first), class: "btn btn-dark w-100 py-2 fw-semibold rounded-3 shadow-sm d-flex align-items-center justify-content-center gap-2 text-decoration-none" do %>
            <i class="bi bi-book"></i>
            Ver receta
          <% end %>
        <% else %>
          <button class="btn btn-secondary w-100 py-2 fw-semibold rounded-3 shadow-sm" disabled>
            Sin plan asignado
          </button>
        <% end %>
      </div>
    </section>

    <!-- Progreso Diario -->
    <section class="card border-0 shadow-sm rounded-4 mb-3" style="background-color: #f8f9fa;">
      <div class="card-body p-3">
        <h2 class="fs-6 fw-bold mb-3">Progreso diario</h2>
        <div class="d-flex flex-column gap-2">
          <!-- Desayuno -->
          <div class="d-flex align-items-center gap-2">
            <span class="text-muted small" style="min-width: 70px;">Desayuno</span>
            <div class="flex-grow-1 bg-secondary bg-opacity-25 rounded-pill" style="height: 16px; overflow: hidden;">
              <div class="bg-success rounded-pill h-100" style="width: 100%;"></div>
            </div>
            <span class="small fw-medium text-end" style="min-width: 90px;"><%= current_patient&.meals&.first&.calories || 0 %><br>kcal</span>
          </div>
          <!-- Almuerzo -->
          <div class="d-flex align-items-center gap-2">
            <span class="text-muted small" style="min-width: 70px;">Almuerzo</span>
            <div class="flex-grow-1 bg-secondary bg-opacity-25 rounded-pill" style="height: 16px; overflow: hidden;">
              <div class="bg-warning rounded-pill h-100" style="width: 110%;"></div>
            </div>
            <span class="small fw-medium text-warning text-end" style="min-width: 90px;"><%= current_patient&.meals&.second&.calories || 0 %><br>kcal</span>
          </div>
          <!-- Cena -->
          <div class="d-flex align-items-center gap-2 opacity-50">
            <span class="text-muted small" style="min-width: 70px;">Cena</span>
            <div class="flex-grow-1 bg-secondary bg-opacity-25 rounded-pill" style="height: 16px;"></div>
            <span class="small text-muted text-end" style="min-width: 90px;"><%= current_patient&.meals&.third&.calories || 0 %><br>kcal</span>
          </div>
          <!-- Snack -->
          <div class="d-flex align-items-center gap-2 opacity-50">
            <span class="text-muted small" style="min-width: 70px;">Snack</span>
            <div class="flex-grow-1 bg-secondary bg-opacity-25 rounded-pill" style="height: 16px;"></div>
            <span class="small text-muted text-end" style="min-width: 90px;"><%= current_patient&.meals&.fourth&.calories || 0 %><br>kcal</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Registrar Comida Button -->
    <% if current_patient.available_meals.any? %>
      <%= link_to new_meal_meal_log_path(current_patient.available_meals.first), class: "btn btn-dark w-100 py-3 fw-semibold rounded-4 shadow-lg mb-3 d-flex align-items-center justify-content-center gap-2 text-decoration-none" do %>
        <i class="bi bi-camera fs-5"></i>
        Registrar comida
      <% end %>
    <% else %>
      <button class="btn btn-secondary w-100 py-3 fw-semibold rounded-4 shadow-lg mb-3 d-flex align-items-center justify-content-center gap-2" disabled>
        <i class="bi bi-camera fs-5"></i>
        No hay comidas disponibles
      </button>
    <% end %>

    <!-- Health Score -->
    <div class="card border-0 shadow-sm rounded-4 mb-3 text-center" style="background-color: #f8f9fa;">
      <div class="card-body p-3">
        <p class="fw-bold fs-5 mb-1">Health Score: 7.6 / 10 ğŸ</p>
        <p class="text-muted mb-0" style="font-size: 0.75rem;">Promedio de tus Ãºltimos 7 dÃ­as</p>
      </div>
    </div>

    <!-- Nivel de EnergÃ­a -->
    <section class="card border-0 shadow-sm rounded-4 mb-3" style="background-color: #f8f9fa;" 
             data-controller="mood-tracker" 
             data-mood-tracker-type-value="energy">
      <div class="card-body p-3">
        <h2 class="fs-6 fw-bold mb-3">Nivel de energÃ­a</h2>
        <div class="d-flex justify-content-around text-center">
          <div class="d-flex flex-column align-items-center gap-1 p-2" 
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="very_low">
            <span style="font-size: 2rem;">ğŸ˜</span>
            <span class="text-muted" style="font-size: 0.7rem;">Muy baja</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="low">
            <span style="font-size: 2rem;">ğŸ˜Ÿ</span>
            <span class="text-muted" style="font-size: 0.7rem;">Baja</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="medium">
            <span style="font-size: 2rem;">âš¡ï¸</span>
            <span class="text-muted" style="font-size: 0.7rem;">Media</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="high">
            <span style="font-size: 2rem;">ğŸ˜</span>
            <span class="text-muted" style="font-size: 0.7rem;">Alta</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="very_high">
            <span style="font-size: 2rem;">ğŸ¤©</span>
            <span class="text-muted" style="font-size: 0.7rem;">Muy alta</span>
          </div>
        </div>
        <div class="mt-3">
          <button data-mood-tracker-target="saveButton" 
                  data-action="click->mood-tracker#save"
                  class="btn btn-primary w-100" 
                  style="display: none;">
            Guardar
          </button>
        </div>
      </div>
    </section>

    <!-- Estado de Ãnimo -->
    <section class="card border-0 shadow-sm rounded-4 mb-3" style="background-color: #f8f9fa;"
             data-controller="mood-tracker" 
             data-mood-tracker-type-value="mood">
      <div class="card-body p-3">
        <h2 class="fs-6 fw-bold mb-3">Estado de Ã¡nimo</h2>
        <div class="d-flex justify-content-around text-center">
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="sad">
            <span style="font-size: 2rem;">ğŸ˜¢</span>
            <span class="text-muted" style="font-size: 0.7rem;">Triste</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="neutral">
            <span style="font-size: 2rem;">ğŸ˜</span>
            <span class="text-muted" style="font-size: 0.7rem;">Neutral</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="calm">
            <span style="font-size: 2rem;">ğŸ˜Œ</span>
            <span class="text-muted" style="font-size: 0.7rem;">Tranquilo</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="happy">
            <span style="font-size: 2rem;">ğŸ™‚</span>
            <span class="text-muted" style="font-size: 0.7rem;">Feliz</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="very_happy">
            <span style="font-size: 2rem;">ğŸ˜„</span>
            <span class="text-muted" style="font-size: 0.7rem;">Muy feliz</span>
          </div>
        </div>
        <div class="mt-3">
          <button data-mood-tracker-target="saveButton" 
                  data-action="click->mood-tracker#save"
                  class="btn btn-primary w-100" 
                  style="display: none;">
            Guardar
          </button>
        </div>
      </div>
    </section>

    <!-- Nivel de Actividad -->
    <section class="card border-0 shadow-sm rounded-4 mb-3" style="background-color: #f8f9fa;"
             data-controller="mood-tracker" 
             data-mood-tracker-type-value="activity">
      <div class="card-body p-3">
        <h2 class="fs-6 fw-bold mb-3">Nivel de actividad</h2>
        <div class="d-flex justify-content-around text-center">
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="very_low">
            <span style="font-size: 2rem;">ğŸ˜´</span>
            <span class="text-muted" style="font-size: 0.7rem;">Muy baja</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="low">
            <span style="font-size: 2rem;">ğŸš¶â€â™€ï¸</span>
            <span class="text-muted" style="font-size: 0.7rem;">Baja</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="medium">
            <span style="font-size: 2rem;">ğŸƒâ€â™€ï¸</span>
            <span class="text-muted" style="font-size: 0.7rem;">Media</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="high">
            <span style="font-size: 2rem;">ğŸ‹ï¸â€â™€ï¸</span>
            <span class="text-muted" style="font-size: 0.7rem;">Alta</span>
          </div>
          <div class="d-flex flex-column align-items-center gap-1 p-2"
               data-mood-tracker-target="option"
               data-action="click->mood-tracker#select"
               data-value="very_high">
            <span style="font-size: 2rem;">ğŸ¤¸â€â™€ï¸</span>
            <span class="text-muted" style="font-size: 0.7rem;">Muy alta</span>
          </div>
        </div>
        <div class="mt-3">
          <button data-mood-tracker-target="saveButton" 
                  data-action="click->mood-tracker#save"
                  class="btn btn-primary w-100" 
                  style="display: none;">
            Guardar
          </button>
        </div>
      </div>
    </section>
  </div>

  <!-- Bottom Navigation -->
  <nav class="navbar fixed-bottom bg-white border-top shadow-sm" style="max-width: 480px; margin: 0 auto;">
    <div class="container-fluid p-0">
      <div class="d-flex w-100 justify-content-around">
        <a href="#" class="nav-link text-success d-flex flex-column align-items-center py-2 flex-fill">
          <i class="bi bi-house-fill fs-5"></i>
          <span style="font-size: 0.7rem; font-weight: 500;">Home</span>
        </a>
        <a href="#" class="nav-link text-secondary d-flex flex-column align-items-center py-2 flex-fill">
          <i class="bi bi-journal-text fs-5"></i>
          <span style="font-size: 0.7rem; font-weight: 500;">Mi Plan</span>
        </a>
        <a href="#" class="nav-link text-secondary d-flex flex-column align-items-center py-2 flex-fill">
          <i class="bi bi-bar-chart-fill fs-5"></i>
          <span style="font-size: 0.7rem; font-weight: 500;">Registros</span>
        </a>
        <a href="#" class="nav-link text-secondary d-flex flex-column align-items-center py-2 flex-fill">
          <i class="bi bi-robot fs-5"></i>
          <span style="font-size: 0.7rem; font-weight: 500;">Copiloto IA</span>
        </a>
      </div>
    </div>
  </nav>
</div>
