<div class="plan-day-card nested-fields" data-controller="nested-form">
  <%= f.hidden_field :_destroy %>

  <!-- Day Header -->
  <div class="day-card-header">
    <div class="d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center gap-3">
        <span class="day-icon">üìÖ</span>
        <div>
          <h4 class="day-title mb-0">Plan Diario</h4>
          <p class="day-subtitle mb-0">Configura las comidas y detalles del d√≠a</p>
        </div>
      </div>
      <button type="button"
              class="btn-remove-day"
              data-action="click->nested-form#remove_association"
              title="Eliminar d√≠a">
        <span>üóëÔ∏è</span>
      </button>
    </div>
  </div>

  <!-- Day Body -->
  <div class="day-card-body">
    <!-- Day Details Grid -->
    <div class="day-details-grid mb-4">
      <div class="detail-item">
        <%= f.input :date,
            label: "üìÜ Fecha",
            as: :date,
            html5: true,
            input_html: { class: "form-control-modern" } %>
      </div>

      <div class="detail-item">
        <%= f.input :mood,
            label: "üòä Estado de √Ånimo",
            collection: ['Excelente', 'Bueno', 'Normal', 'Bajo', 'Muy bajo'],
            include_blank: 'Seleccionar',
            input_html: { class: "form-control-modern" } %>
      </div>

      <div class="detail-item">
        <%= f.input :energy_level,
            label: "‚ö° Nivel de Energ√≠a",
            collection: ['Muy alto', 'Alto', 'Medio', 'Bajo', 'Muy bajo'],
            include_blank: 'Seleccionar',
            input_html: { class: "form-control-modern" } %>
      </div>

      <div class="detail-item">
        <%= f.input :activity,
            label: "üèÉ Actividad F√≠sica",
            collection: ['Sedentario', 'Ligero', 'Moderado', 'Activo', 'Muy activo'],
            include_blank: 'Seleccionar',
            input_html: { class: "form-control-modern" } %>
      </div>
    </div>

    <%= f.input :notes,
        label: "üìù Notas del D√≠a",
        as: :text,
        input_html: { rows: 2, class: "form-control-modern", placeholder: "Observaciones o instrucciones especiales para este d√≠a..." } %>

    <!-- Meals Section -->
    <div class="meals-section mt-4">
      <div class="meals-section-header">
        <div class="d-flex align-items-center justify-content-between">
          <div class="d-flex align-items-center gap-2">
            <span class="meals-icon">üçΩÔ∏è</span>
            <h5 class="meals-title mb-0">Comidas del D√≠a</h5>
          </div>
          <button type="button"
                  class="btn-add-meal"
                  data-action="click->nested-form#add_association"
                  data-association-insertion-node=".meals-<%= f.object.object_id %>"
                  data-association-insertion-method="append">
            <span class="btn-icon">‚ûï</span>
            <span>Agregar Comida</span>
          </button>
        </div>
      </div>

      <div class="meals-container meals-<%= f.object.object_id %>">
        <%= f.simple_fields_for :meals do |meal_form| %>
          <%= render 'meal_fields', f: meal_form %>
        <% end %>
      </div>

      <template data-nested-form-target="template">
        <%= f.simple_fields_for :meals, Meal.new, child_index: 'TEMPLATE_RECORD' do |meal_form| %>
          <%= render 'meal_fields', f: meal_form %>
        <% end %>
      </template>
    </div>
  </div>
</div>

<style>
/* Plan Day Card Styles */
.plan-day-card {
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.2s;
}

.plan-day-card:hover {
  border-color: #8b5cf6;
  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1);
}

.day-card-header {
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  border-bottom: 2px solid #e5e7eb;
  padding: 1.25rem 1.5rem;
}

.day-icon {
  font-size: 1.75rem;
}

.day-title {
  font-size: 1.125rem;
  font-weight: 700;
  color: #1f2937;
}

.day-subtitle {
  font-size: 0.8125rem;
  color: #6b7280;
  margin-top: 0.25rem;
}

.btn-remove-day {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fee2e2;
  border: 1px solid #fecaca;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 1rem;
}

.btn-remove-day:hover {
  background: #fecaca;
  border-color: #fca5a5;
  transform: scale(1.05);
}

.day-card-body {
  padding: 1.5rem;
}

/* Day Details Grid */
.day-details-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.detail-item label {
  font-weight: 600;
  color: #374151;
  font-size: 0.875rem;
  margin-bottom: 0.5rem;
}

/* Meals Section */
.meals-section {
  background: #f8fafc;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 1.25rem;
}

.meals-section-header {
  margin-bottom: 1.25rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #e5e7eb;
}

.meals-icon {
  font-size: 1.25rem;
}

.meals-title {
  font-size: 1rem;
  font-weight: 700;
  color: #374151;
}

.btn-add-meal {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.5rem 1rem;
  background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
  color: white;
  border: none;
  border-radius: 6px;
  font-weight: 500;
  font-size: 0.8125rem;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 2px 4px rgba(139, 92, 246, 0.2);
}

.btn-add-meal:hover {
  background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3);
}

.meals-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

/* Responsive */
@media (max-width: 768px) {
  .day-details-grid {
    grid-template-columns: 1fr;
  }

  .day-card-header,
  .day-card-body {
    padding: 1rem;
  }

  .meals-section {
    padding: 1rem;
  }
}
</style>
