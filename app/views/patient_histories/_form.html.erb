<%= simple_form_for [@patient, @patient_history] do |f| %>
  <div class="row">
    <div class="col-md-6">
      <%= f.input :visit_date, label: "Fecha de Visita", as: :date, html5: true, required: true %>
    </div>
    <div class="col-md-6">
      <%= f.input :weight, label: "Peso (kg)", input_html: { step: 0.1 } %>
    </div>
  </div>

  <div class="mb-3">
    <%= f.association :nutrition_plan,
        collection: @nutrition_plans,
        label: "Plan Nutricional Asociado",
        label_method: lambda { |plan| "#{plan.objective&.truncate(40)} (#{plan.start_date} - #{plan.end_date})" },
        include_blank: "Sin plan asociado",
        input_html: { class: 'form-select' } %>
  </div>

  <div class="mb-3">
    <%= f.input :metrics,
        label: "MÃ©tricas Adicionales (JSON)",
        as: :text,
        hint: "Ejemplo: {\"imc\": 24.5, \"grasa_corporal\": 18, \"masa_muscular\": 45}",
        input_html: { rows: 3 } %>
  </div>

  <div class="mb-3">
    <%= f.input :notes,
        label: "Notas del Control",
        as: :text,
        placeholder: "Observaciones, cambios en el plan, recomendaciones, etc.",
        input_html: { rows: 6 } %>
  </div>

  <div class="d-flex gap-2">
    <%= f.submit "Guardar Control", class: "btn btn-primary" %>
    <%= link_to "Cancelar", patient_patient_histories_path(@patient), class: "btn btn-secondary" %>
  </div>
<% end %>
